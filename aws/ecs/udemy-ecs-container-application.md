# ECSの学習

## 学習内容
### 技術
- コンテナアプリの背景と起訴
- マイクロサービスアーキテクチャ
- CICDパイプライン
- 状態管理
- デプロイ手法
- オートスケーリング
- ネットワーク

### フェーズ
- 基礎
- 設計・開発
- リリース
- 運用

## コンテナアプリケーション開発の基本
### コンテナとは??
- アプリケーションとそれに必要な周辺ソフトウェアをパッケージ化したもの
ホストマシンから隔離されているため影響を受けない。
持ち運び可能。
- 開発環境の統一
- スケーラビリティ: コンテナを増やすことで簡単にアプリをスケールできる
- CI/CDとの相性: テスト -> そのまま本番環境にデプロイできる

### スケーリング
システムの利用者の増大に応じて、システム規模を拡大縮小すること。スケーラビリティ = スケールのしやすさ
コンテナは即立ち上げ可能なため、ユーザーが増えたらスケールさせることが容易。
一つのホストマシンだと、CPUやメモリが足りなくなるが、AWSなどクラウドインフラだとクリック一つで増やせるためコンテナと相性がいい。

### コンテナオーケストレーション
ユーザーの増減に応じてコンテナを増やしたり減らしたりをする必要がある。1台のサーバではできないため複数サーバを用意する必要がある。
どのサーバに配置するかを解決してくれるのがコンテナオーケストレータ。
CPUメモリリソース・負荷状況を監視 -> どのサーバに配置するのが最適か・効率的か判断、不要なコンテナを破棄。

### ECSの基本構造
![learn-ecs drawio](https://github.com/user-attachments/assets/f1efd6ac-a48f-4fcb-afd7-9dc29f2a8941)

TaskはServiceの中でなく単体でも可能
Taskが最小単位としてコンテナデプロイを行っている。
Task = 1つ以上持たせることが可能。
#### Task定義: Taskそのものの設計図で、Taskを作成し、ECSに与えることで作りたいコンテナを作成。(Json)
コンテナ設定・リソース設定・環境変数・ログ設定などコンテナに必要なものを定義

#### Service
Taskの状態・個数を理想状態に維持する
- Taskの維持管理
- スケーリング
- 負荷分散
- アップデートとデプロイ

### ECSの作成手順
Cluster -> Service -> Task

### ECSの実行環境
1. EC2ベースの実行環境
   - 高い柔軟性
   - コスト最適
   - OS等管理コストがかかる
2. Fargateの実行環境
   - サーバレスでOS等管理が不要
   - シンプルで簡単に始めやすい
   - 柔軟性が低い

### ECR
コンテナイメージを格納、管理、デプロイするためのAWSサービス。
コンテナイメージの保存・管理を可能にする = コンテナイメージレジストリの一種。

## AWSのネットワーク
### VPC・Subnet
- VPC: AWS上に自由に作成できる専用の仮想ネットワーク環境。
- Subnet: VPC上のIPアドレス範囲を区切ったネットワーク空間。複数作成可能。
- 手順: VPC -> Subnet の順に作成

### プライベートIPアドレス
- グローバルIPアドレス: インターネット上で一意的なアドレス
- プライベートIPアドレス: 特定のネットワーク内でのみ使用されるアドレス

#### プライベートIPアドレスの範囲
RFCの規格で決まっている
[RFC](https://datatracker.ietf.org/doc/html/rfc1918)
10.0.0.0 - 10.255.255.255
172.16.0.0 - 172.31.255.255
192.168.0.0 - 192.168.255.255

### CIDR
プライベート内で無秩序にIPアドレスを使用すると、通信はできるが管理が難しくなる。将来増やしたい場合などに重複が発生する可能性がある。
IPアドレスの衝突を考慮して、利用するプライベートIPアドレスの範囲を決める必要がある。-> CIDRで定義

10.0.0 -> network部
.1 -> host部

#### ネットワーク部
どのネットワークかを特定するもの。

#### ホスト部
ネットワーク内の機器を特定するもの。

IPアドレスは 0 - 255 の数字を組み合わせたもの
2進数で表現
ネットワーク部の範囲とホスト部の範囲はケースバイケース

- ネットワーク部の範囲が広い場合: 多くのネットワークグループが作れるが、少しの機器しかネットワークに紐づけられない。
- ホスト部の範囲が広い: 少しのネットワークグループしか作られないが、多くの機器がネットワークに紐づけられる。

#### CIDRとは?
ネットワークのアドレスとネットワーク部の範囲を表す記法。利用できるIPアドレスの範囲が分かる。

- ネットワーク部が28bitある場合: このネットワークでは 10.0.0.0 ~ 10.0.0.15 の範囲でIPアドレスが利用できる。
10.0.0.0/28 = 00001010.00000000.00000000.0000(0001)
IPアドレスは全部で32個あるのだが、上記の例では28個までがネットワーク部ということ。
残りの4個はホスト部で、それぞれのIPアドレスを区別するために使用する。
4ビットの組み合わせ: 0000, 0001, 0010, ... , 1111 （合計16種類）
つまり、CIDR「/28」ではネットワークの一部を固定して、残りの部分でこのネットワーク内のアドレスを割り当てる仕組み。

- 例 VPC: 10.0.0.0/16 = 10.0.0.0 ~ 10.0.255.255
- 例 Subnet1: 10.0.0.0/24 = 10.0.0.0 ~ 10.0.0.255
- 例 Subnet2: 10.0.1.0/24 = 10.0.1.0 ~ 10.0.1.255
