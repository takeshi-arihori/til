# AWSコンテナ設計・構築[本格]入門

## コンテナ技術を導入するために考慮すべきこと
- **コンテナを前提としたアプリケーション開発の在り方**
  分散システム構成になってしまうため、コンテナ間の疎結合性や移植性を考慮した方式を検討する必要がある。  
  コンテナのディスク領域は揮発性の打雨コンテナ破棄と同時に内部データは削除されてしまう。
  [The Twelve-Factor App](https://12factor.net/ja/)
  
- **コンテナ設計・運用に取り組む際の姿勢**
  レジストリ上のイメージに関するライフサイクル管理やイメージ野保護など、新たな運用が発生。
  ビルドからデプロイまでの流れや、コンテナオーケストレーション自体の権限制御、定義管理、セキュリティ設定等など。
  
## アーキテクチャ構成例
### ECS on Fargate:  
Fargate上にECSのタスクを起動してタスク上でコンテナを稼働させる
- **コスト:**
  vCPUとメモリリソース -> コンテナイメージを取得した時点からECSタスクが終了するまでを対象として計算される  
  インフラ管理の保守管理コストから解放される。
  デプロイは比較的遅い。(コンテナごとにENIがアタッチされる、イメージキャッシュができない)
  AWSマネージドなホストのため、基本的にはSSHログインはできない(`ECS Exec`でコンテナとの対話シェル、コマンドが実行可能に)

### ビルディングブロックという思想

**ビルディングブロック**: AWSのサービス群をブロックのようにうまく組み合わせて利用すること  

![aws-container-basic drawio](https://github.com/user-attachments/assets/001f394f-3806-4de8-8026-9988e2910757)

## Well-Architectedフレームワークの活用
5つの設計原則
- **運用上の優秀性**
  - どのようにシステムの状態を把握するか
  - どのように不具合の修正を容易にするか
  - どのようにデプロイのリスクを軽減するか
- **セキュリティ**
- **信頼性**
- **パフォーマンス効率**
- **コスト最適化**

### サンプルアプリの機能構成

![aws-container-basic-sec03 sample-application drawio](https://github.com/user-attachments/assets/4e142629-4601-4df9-bdc7-0b84b5271a2d)


### 設計で求められる要件と基本アーキテクチャ
- 多数の一般ユーザーに利用してもらうことを想定し、柔軟にスケール可能な構成にしたい
- 可用性を高めるためにマルチAZを基本構成としたい
- CI/CDパイプラインを構成し、アプリケーションリリースに対するアジリティを高めたい
- 各レイヤで適切なセキュリティ対策(不正アクセス対策、認証データの適切な管理、ログ保存、踏み台経由の内部アクセス等)を施したい

### AWS基本構成図

![aws-container-basic-sec03 sample-application-aws-diagram drawio](https://github.com/user-attachments/assets/bb11ea88-6129-4fbd-a5d1-ea8c8052f863)

**モニタリングの目的:** システムの可用性を維持するために問題発生に気づくこと(利用者に対してアプリケーションが利用可能な状態を維持するために行う)
**オブザーバビリティ(可観測性):** システム全体を俯瞰しつつ、内部状態まで負荷彫りできるような状態  
**オブザーバビリティを獲得するために必要な要素:** 検知(メトリクス) -> 把握(トレース) -> 特定(ログ)


**ログ運用:** ビジネス観点でログをどのように扱うかユースケースを描いておく
