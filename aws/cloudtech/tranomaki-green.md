# AWS の作成手順
## ルートユーザーで行うこと
- MFAを追加
- CloudWatchによる請求アラートの設定
- CloudWatch -> 請求 (リージョンをバージニアにして作成) -> 請求アラームの設定
- AWS Cost Explorerの有効化
- 証跡の作成
- IAMユーザーの作成

## 仮想ネットワークの作成
サーバとは高性能なコンピュータ
ネットワーク環境を用意する役割を果たすのがVPC
プライベートネットワーク = 内部ネットワーク

### Amazon VPC
AWS上に自分用の仮想的なネットワークを作成し、セキュリティとネットワークの設定をカスタマイズする。
IPアドレス範囲やサブネット、ルートテーブルを自分で設定し、トラフィックの制御やアクセス制限も可能。
Webサーバやデータベースサーバを配置するためのネットワーク基盤として作成

### Subnet
ネットワーク内の一部のセグメントを指す用語であり、IPアドレス範囲を意味する。
VPC内でサブネットを作成することで、ネットワークを論理的に分割し、それぞれのサブネットにIPアドレス範囲を割り当てることができる。(ネットワークトラフィックの制御やセキュリティの強化が可能)
AZ(AWSにおけるデータセンターのようなイメージ)を設定

### ルートテーブル
ネットワークトラフィックの送信先を制御するための設定。
VPCでは、VPC内のサブネットごとにルートテーブルを定義。
送信先としての宛先CIDRブロックと、それに対応するゲートウェイやネットワークインターフェースが設定される。
ネットワーク内のパケットがどの方向に送信されるかを決定し、トラフィックの経路を制御する。
例: インターネットにアクセスするには、パブリックサブネットに対してインターネットゲートウェイへの経路を指定する必要がある。

### インターネットゲートウェイ
VPC内のプライベートネットワークとインターネットを接続する役割を持つ。
IGを使用すると、VPC内のパブリックサブネットに配置されたリソースがインターネットと通信できる。
IGは、VPC内でルートテーブルの設定として使用され、VPC内のトラフィックの経路を制御する。つまり、インターネットゲートウェイを通じてパブリックなインターネットへの通信を可能にする。

### 作成手順
VPC -> Subnet -> Internet-gateway -> ルートテーブルに追加


## Webサーバの構築

[aws-cloudtech.drawio.pdf](https://github.com/user-attachments/files/16905892/aws-cloudtech.drawio.pdf)


### Amazon EC2
コンピューティング能力やメモリ、ストレージなどのリソースを柔軟に調整でき、いろいろな用途に適した仮想マシンを提供する。

### セキュリティグループ
AWS におけるネットワークセキュリティのための設定。
ユーザーが設定したルールに基づいて、ネットワークトラフィックの制御を行う。

### 作成手順
EC2 -> セキュリティグループインバウンドルールの設定 -> Apacheのインストール

### AmazonLinux上でのApache・gitインストール手順
```
sudo yum update
sudo yum install httpd
sudo yum install php
sudo service httpd start
sudo yum update
sudo yum install git
sudo chkconfig httpd on
```

## データベースの構築
[参考コマンド](https://github.com/CloudTechOrg/book-publish-web-application/blob/main/commands/chapter6.md)
[EC2上にMySQLインストール時のエラー](https://github.com/takeshi-arihori/til/blob/main/aws/ec2/gpg_error.md)

### Amazon RDS
データベースのバックアップ、パフォーマンスの監視、スケーリングなどの作業の自動化されており、高い可溶性と信頼性を提供。セキュリティも重視 -> データの暗号化やアクセス制御などの機能も用意されている。

### 作成手順
Subnet(DB用を2つ, 別のアベイラビリティゾーンで作成) -> RDS(サブネットグループを作成) -> DB作成 -> RDSにセキュリティグループの追加 -> EC2を踏み台にしてRDSに接続テスト -> パッケージのインストール -> 

## 負荷分散
Webサーバーの負荷分散を行う。
複数のアベイラビリティゾーンにまたがってサーバを配置して負荷分散を行うことで、アベイラビリティゾーンに障害が発生してもシステムが停止せずに稼働させることができる。(マルチAZ構成)
![aws-cloudtech drawio](https://github.com/user-attachments/assets/dfdc36bc-de0d-4292-9d0f-3ec12a2e5e51)

### マルチAZ構成
アプリケーションやデータベースなどのリソースを複数のAZに分散させることで可用性と耐障害性を向上させる仕組み。
1つのAZに障害が発生した場合でも、他のAZでサービスを継続することができる。

![aws-cloudtech drawio](https://github.com/user-attachments/assets/c77f748f-838e-4c6f-a863-9ec1bfd5fe0c)

### AMI
AWSで使用される仮想マシンのテンプレート。


### ELB
レイヤー7(アプリケーション層)での負荷分散に適していて、HTTP/HTTPSトラフィックを効率的に処理する。

### 手順
別AZにサブネットを作成 -> 作成したEC2インスタンスからAMIを作成 -> ターゲットグループを作成 -> ELBを配置(セキュリティグループ作成・ロードバランサーの作成) -> webサーバーセキュリティ更新 -> 


## Auto Scaling
サーバのリソースを自動的に増減させる機能。
サーバのメモリなどのリソースを監視し、リソースが逼迫した場合にリソースを増加させたり、リソースが充足してきたら削減するといったことができる。
![aws-cloudtech drawio](https://github.com/user-attachments/assets/ac861790-1ee4-480a-b3b4-66938b166f31)

### 起動テンプレート
EC2インスタンスやリソースを自動作成するためのテンプレート。
Auto Scalingを用いてEC2を起動する際のテンプレートとして作成。

### 手順
起動テンプレートの作成 -> Auto Scalingグループの作成


## 独自ドメインの設定
Route53を使用

## HTTPS化
HTTPSプロトコル通信ができるようにする。
証明書を発行 -> 提供サービス(ALB)に設定
証明書はAWS以外の機関でも発行することができるが、AWSではACMというサービスを使って証明書を発行し、それを各種サービスに割り当てることができる。

### HTTPSプロトコル
HTTPS(HyperText Transfer Protocol Secure)は、ウェブブラウジングやデータ通信におけるセキュリティを強化するプロトコル。暗号化されており、データの盗聴や改ざんを防止する。
SSL(Secure Socket Layer)またはTLS(Transport Layer Security)というセキュリティプロトコルを使用して実現される。このプロトコルにより、データは通信元から送信先までの間で暗号化され、第三者による不正なアクセスやデータ漏洩を防ぐ。

### サーバ証明書
ウェブサイトやアプリケーションなどのサーバが、HTTPSプロトコルを使用して安全な通信を行うために使用されるデジタル証明書。
サーバの公開鍵と識別情報が含まれており、通信相手に対してサーバの正当性を検証する役割を果たす。
サーバ証明書は、信頼性のある第三者の認証局(CA:Certificate Authority)によって発行される。
認証局は、サーバの所有者がドメイン名を管理していることを確認し、公開鍵を含む証明書に署名する。

### ACM
ACM(AWS Certificate Manager)は、AWSが提供する完全マネージドな証明書管理サービス。
ACMを使用することで、SSL/TLS証明書を簡単に取得、発行、管理できる。無料で提供され、AWSリソース上で使用される証明書を容易にセットアップできる。

![aws-cloudtech-ACM drawio](https://github.com/user-attachments/assets/9b308970-73cd-42e7-a3fe-9b9cc170057c)

### 手順
サーバ証明書の発行 -> ALBに証明書を紐づけ

## CDNの利用
### 手順
CloudFront用の証明書を作成




